<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />

  <title>
    
      Sealing Example &middot; SGX 101
    
  </title>

  


  <!-- CSS -->
  <link rel="stylesheet" href="/sgx101/assets/css/main.css" />
  

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface" />

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/sgx101/favicon.png" />
<link rel="shortcut icon" href="/sgx101/favicon.ico" />

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" />

  <!-- Additional head bits without overriding original head -->
</head>


  <body class="page">

    <div id="sidebar">
  <header>
    <div class="site-title">
      <a href="/sgx101/">
        
          <span class="back-arrow icon"><svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
  <path d="M0 0h24v24H0z" fill="none"/>
  <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
</svg></span>
        
        SGX 101
      </a>
    </div>
    <p class="lead">The very first place to study Intel SGX.</p>
  </header>
  <nav id="sidebar-nav-links">
  
    <a class="home-link "
        href="/sgx101/">Home</a>
  
  

  

  


  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
      <a class="page-link "
          href="/sgx101/sslab.html">SSLab</a>
    
  

  
    
      <a class="page-link "
          href="/sgx101/bootstrap.html">SGX Bootstrap</a>
    
  

  
    
      <a class="page-link "
          href="/sgx101/resources.html">Resources</a>
    
  

  
    
      <a class="page-link "
          href="/sgx101/about.html">About Us</a>
    
  


  


  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  


  <!-- Optional additional links to insert in sidebar nav -->
</nav>


  

  <nav id="sidebar-icon-links">
  

  <a id="subscribe-link"
     class="icon" title="Subscribe" aria-label="Subscribe"
     href="/sgx101/feed.xml">
    <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <circle cx="6.18" cy="17.82" r="2.18"/>
    <path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/>
</svg>
  </a>

  
  
  
  

  
    <a id="tags-link"
       class="icon"
       title="Tags" aria-label="Tags"
       href="/sgx101/tags.html">
      <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
    </a>
  

  
    <a id="search-link"
       class="icon"
       title="Search" aria-label="Search"
       href="/sgx101/search.html">
      <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
    <path d="M0 0h24v24H0z" fill="none"/>
</svg>
    </a>
  

  <!-- Optional additional links to insert for icons links -->
</nav>

  <p>
  &copy; 2018.
  <a href="https://gts3.org/">SSLab.</a>
</p>

</div>

    <main class="container">
      <header>
  <h1 class="page-title">Sealing Example</h1>
</header>
<div class="content">
  <p>This sealing example is only for illustration purpose. It generates a random number inside the enclave and calls the sealing api to seal it. Then it unseals the sealed data structure to verify the number. Code is available <a href="https://github.com/sangfansh/SGX101_sample_code">here</a>.</p>

<p>Original unmodified version is available <a href="https://github.com/digawp/hello-enclave">here</a>.</p>

<p>In <code class="highlighter-rouge">App.cpp</code>:</p>

<script src="https://gist.github.com/sangfansh/9859ce170fce4fa63deba999d6d13326.js"></script>

<p>The application first initializes the enclave in the main function. Then it makes an <code class="highlighter-rouge">ECall</code> into the enclave to generate a random number (a fake random number just for simplicity).</p>

<script src="https://gist.github.com/sangfansh/a55622c217d4ce1b8d469667e27e615b.js"></script>

<p>In order to seal the number, the application first has to <strong>allocate memory</strong> for sealed data block (line 30 at App.cpp). Then it makes another <code class="highlighter-rouge">ECall</code> into the enclave to seal the random secret.</p>

<p>The <code class="highlighter-rouge">seal()</code> function is an <code class="highlighter-rouge">ECall</code> wrapper function of the trusted SGX sealing api. It passes the required parameters into function <code class="highlighter-rouge">sgx_seal_data()</code> provided by SGX SDK (<code class="highlighter-rouge">Sealing.cpp</code>). If this ECall returns successfully, the random secret will be securely sealed in <code class="highlighter-rouge">(sgx_sealed_data_t*)sealed_data</code>.</p>

<script src="https://gist.github.com/sangfansh/67214567d3edf0223a1fc925e0d0f698.js"></script>

<p>After the random secret is successfully sealed, the application makes another <code class="highlighter-rouge">ECall</code> <code class="highlighter-rouge">unseal()</code> to unseal the sealed_data. Function <code class="highlighter-rouge">unseal()</code> is also a wrapper function of the trusted SGX sealing api <code class="highlighter-rouge">sgx_unseal_data()</code>. If this <code class="highlighter-rouge">ECall</code> returns successfully, the unsealed content of <code class="highlighter-rouge">sealed_data</code> will be stored into <code class="highlighter-rouge">intÂ unsealed</code>.</p>

<p>Finally the application verifies the result by printing out and comparing the unsealed secret with the original generated random number (line 50 at <code class="highlighter-rouge">App.cpp</code>).</p>

<p>To compile and run this example, run make inside the example directory and type <code class="highlighter-rouge">./app</code> to run the application. It should produce some output like this:</p>

<p><img src="/sgx101/assets/pics/sealing_example.png" alt="sealing" /></p>

</div>

    </main>

    <!-- Optional footer content -->

  </body>
</html>
